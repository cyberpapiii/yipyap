<!DOCTYPE html>
<html lang="en" class="bg-background">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/svg+xml" href="%sveltekit.assets%/favicon.svg" />
	<link rel="shortcut icon" type="image/svg+xml" href="%sveltekit.assets%/favicon.svg" />
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />

	<!-- Color scheme - force dark only -->
	<meta name="color-scheme" content="only dark" />
	<meta name="supported-color-schemes" content="dark" />

	<!-- Aggressive dark mode enforcement - prevents iOS light mode flash -->
	<style>
		html, body {
			background-color: #101010 !important;
			color: #fafafa !important;
			color-scheme: only dark !important;
		}
		* {
			color-scheme: only dark !important;
		}
	</style>

	<!-- PWA Meta Tags -->
	<link rel="manifest" href="%sveltekit.assets%/manifest.json" />
	<meta name="theme-color" content="#101010" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-title" content="YipYap" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="msapplication-TileColor" content="#101010" />
	<meta name="msapplication-tap-highlight" content="no" />

	<!-- iOS Icons and Push Support -->
	<link rel="apple-touch-icon" href="%sveltekit.assets%/apple-touch-icon.png" />
	<link rel="apple-touch-icon" sizes="180x180" href="%sveltekit.assets%/apple-touch-icon.png" />
	<meta name="apple-mobile-web-app-push-notification-enabled" content="yes" />

	<title>YipYap - Anonymous Dimes Square Community</title>
	<meta name="description" content="Anonymous local community for Dimes Square. Express yourself with subway line identities." />

	<!-- Open Graph -->
	<meta property="og:title" content="YipYap - Anonymous Dimes Square Community" />
	<meta property="og:description" content="Anonymous local community for Dimes Square. Express yourself with subway line identities." />
	<meta property="og:type" content="website" />
	<meta property="og:image" content="%sveltekit.assets%/icon-512.png" />

	<!-- Twitter -->
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:title" content="YipYap - Anonymous Dimes Square Community" />
	<meta name="twitter:description" content="Anonymous local community for Dimes Square" />

	%sveltekit.head%
</head>
<body data-sveltekit-preload-data="hover" class="bg-background text-foreground">
	<div style="display: contents">%sveltekit.body%</div>

	<script>
		// PWA install prompt handling
    // Clean up any legacy service workers (e.g., /sw.js from older setup)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => {
        for (const reg of regs) {
          // If an old worker with a different filename is controlling, unregister it
          if (reg.active && reg.active.scriptURL.endsWith('/sw.js')) {
            reg.unregister().catch(() => {})
          }
        }
      }).catch(() => {})
    }

		let deferredPrompt;
		window.addEventListener('beforeinstallprompt', (e) => {
			e.preventDefault();
			deferredPrompt = e;
			// Trigger custom install UI
			window.dispatchEvent(new CustomEvent('pwa-installable'));
		});

		// Track app installs
		window.addEventListener('appinstalled', () => {
			console.log('BingBong installed');
		});

		// Online/offline handling
		window.addEventListener('online', () => {
			window.dispatchEvent(new CustomEvent('app-online'));
		});

		window.addEventListener('offline', () => {
			window.dispatchEvent(new CustomEvent('app-offline'));
		});
	</script>
</body>
</html>
